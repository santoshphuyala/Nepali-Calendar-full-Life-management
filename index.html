<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Complete Nepali Calendar with Finance, Insurance, Vehicle, Subscription Management">
    <meta name="theme-color" content="#4A90E2">
    <title>Nepali Calendar 2082‚Äì2092 - Complete Manager</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='80'>üìÖ</text></svg>">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <h1>üìÖ Nepali Calendar</h1>
            <div class="header-dates">
                <div class="bs-date" id="headerBSDate">BS: Loading...</div>
                <div class="ad-date" id="headerADDate">AD: Loading...</div>
            </div>
        </div>
        <button class="today-btn" id="todayBtn">üìç Today</button>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
        <button class="nav-tab active" data-view="calendar">üìÖ Calendar</button>
        <button class="nav-tab" data-view="tracker">üí∞ Finance Tracker</button>
        <button class="nav-tab" data-view="financial">üí≥ Financial Manager</button>
        <button class="nav-tab" data-view="assets">üõ°Ô∏è Asset Manager</button>
        <button class="nav-tab" data-view="medicine">üíä Medicine Tracker</button>
        <button class="nav-tab" data-view="notes">üìù Notes</button>
        <button class="nav-tab" data-view="settings">‚öôÔ∏è Settings</button>
    </nav>

    <!-- Main Container -->
    <main class="main-container">
        
        <!-- Calendar View -->
        <section id="calendarView" class="view active">
            <!-- View Switcher -->
            <div class="view-switcher">
                <button class="view-switch-btn" data-calendar-view="year">Year</button>
                <button class="view-switch-btn active" data-calendar-view="month">Month</button>
                <button class="view-switch-btn" data-calendar-view="week">Week</button>
                <button class="view-switch-btn" data-calendar-view="day">Day</button>
            </div>

            <!-- Calendar Controls -->
            <div class="calendar-controls">
                <button id="prevMonth">‚óÄ</button>
                <div class="date-selector">
                    <select id="yearSelect"></select>
                    <select id="monthSelect"></select>
                </div>
                <button id="nextMonth">‚ñ∂</button>
                
                <!-- Import and Export Buttons -->
                <div class="import-export-buttons">
                    <!-- Export Dropdown -->
                    <div class="dropdown-container">
                        <button class="btn-export" id="calendarExportBtn">
                            üì§ Export
                        </button>
                        <div class="dropdown-menu" id="calendarExportMenu">
                            <button class="dropdown-item" onclick="exportCalendarData('monthly')">
                                üìÑ Export Monthly Calendar
                            </button>
                            <button class="dropdown-item" onclick="exportCalendarData('yearly')">
                                üìÖ Export Yearly Calendar
                            </button>
                            <button class="dropdown-item" onclick="exportCalendarData('holidays')">
                                üéâ Export Yearly Holidays
                            </button>
                            <button class="dropdown-item" onclick="exportCalendarData('events')">
                                üìù Export All Events & Notes
                            </button>
                            <button class="dropdown-item" onclick="exportCalendarData('complete')">
                                üì¶ Export Complete Calendar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Import Dropdown -->
                    <div class="dropdown-container">
                        <button class="btn-import" id="calendarImportBtn">
                            üì• Import
                        </button>
                        <div class="dropdown-menu" id="calendarImportMenu">
                            <button class="dropdown-item" onclick="document.getElementById('calendarImportMonthly').click()">
                                üìÖ Import Monthly Calendar
                            </button>
                            <button class="dropdown-item" onclick="document.getElementById('calendarImportYearly').click()">
                                üìÖ Import Yearly Calendar
                            </button>
                            <button class="dropdown-item" onclick="document.getElementById('calendarImportHolidays').click()">
                                üéâ Import Holidays
                            </button>
                            <button class="dropdown-item" onclick="document.getElementById('calendarImportEvents').click()">
                                üìù Import Events & Notes
                            </button>
                            <button class="dropdown-item" onclick="document.getElementById('calendarImportComplete').click()">
                                üì¶ Import Complete Calendar
                            </button>
                            <input type="file" id="calendarImportMonthly" accept=".json,.xlsx,.xls" style="display: none;" onchange="importCalendarData('monthly', this)">
                            <input type="file" id="calendarImportYearly" accept=".json,.xlsx,.xls" style="display: none;" onchange="importCalendarData('yearly', this)">
                            <input type="file" id="calendarImportHolidays" accept=".json,.xlsx,.xls" style="display: none;" onchange="importCalendarData('holidays', this)">
                            <input type="file" id="calendarImportEvents" accept=".json,.xlsx,.xls" style="display: none;" onchange="importCalendarData('events', this)">
                            <input type="file" id="calendarImportComplete" accept=".json,.xlsx,.xls" style="display: none;" onchange="importCalendarData('complete', this)">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Year View -->
            <div id="yearView" class="calendar-view-container">
                <div class="year-grid" id="yearGrid"></div>
                
                <!-- Yearly Holiday List -->
                <div class="yearly-holiday-list" id="yearlyHolidayList">
                    <h4>üéâ Yearly Holidays</h4>
                    <div id="yearlyHolidayContent"></div>
                </div>
                
                <!-- Yearly Summary -->
                <div class="yearly-summary" id="yearlySummary">
                    <h4>üìä Yearly Summary</h4>
                    <div id="yearlySummaryContent"></div>
                </div>
            </div>

            <!-- Month View -->
            <div id="monthView" class="calendar-view-container active">
                <div class="calendar-grid" id="calendarGrid">
                    <div class="day-header">‡§Ü‡§á‡§§</div>
                    <div class="day-header">‡§∏‡•ã‡§Æ</div>
                    <div class="day-header">‡§Æ‡§Ç‡§ó‡§≤</div>
                    <div class="day-header">‡§¨‡•Å‡§ß</div>
                    <div class="day-header">‡§¨‡§ø‡§π‡§ø</div>
                    <div class="day-header">‡§∂‡•Å‡§ï‡•ç‡§∞</div>
                    <div class="day-header saturday">‡§∂‡§®‡§ø</div>
                </div>
                
                <!-- Monthly Holiday List -->
                <div class="monthly-holiday-list" id="monthlyHolidayList">
                    <h4>üéâ Monthly Holidays</h4>
                    <div id="monthlyHolidayContent"></div>
                </div>
                
                <!-- Monthly Notes List -->
                <div class="monthly-notes-list" id="monthlyNotesList">
                    <h4>üìù Monthly Notes & Events</h4>
                    <div id="monthlyNotesContent"></div>
                </div>
            </div>

            <!-- Week View -->
            <div id="weekView" class="calendar-view-container">
                <div class="week-grid" id="weekGrid"></div>
                
                <!-- Weekly Holiday List -->
                <div class="weekly-holiday-list" id="weeklyHolidayList">
                    <h4>üéâ Weekly Holidays</h4>
                    <div id="weeklyHolidayContent"></div>
                </div>
                
                <!-- Weekly Summary -->
                <div class="weekly-summary" id="weeklySummary">
                    <h4>üìä Weekly Summary</h4>
                    <div id="weeklySummaryContent"></div>
                </div>
            </div>

            <!-- Day View -->
            <div id="dayView" class="calendar-view-container">
                <div class="day-detail" id="dayDetail"></div>
                
                <!-- Daily Summary -->
                <div class="daily-summary" id="dailySummary">
                    <h4>üìä Daily Summary</h4>
                    <div id="dailySummaryContent"></div>
                </div>
            </div>

            <!-- Monthly Summary Dashboard -->
            <div class="dashboard">
                <h3>üìä Monthly Summary</h3>
                <div class="summary-cards">
                    <div class="summary-card income">
                        <span class="label">Income</span>
                        <span class="value" id="monthlyIncome">Rs. 0</span>
                    </div>
                    <div class="summary-card expense">
                        <span class="label">Expenses</span>
                        <span class="value" id="monthlyExpense">Rs. 0</span>
                    </div>
                    <div class="summary-card savings">
                        <span class="label">Savings</span>
                        <span class="value" id="monthlySavings">Rs. 0</span>
                    </div>
                    <div class="summary-card budget">
                        <span class="label">Budget Left</span>
                        <span class="value" id="budgetRemaining">Rs. 0</span>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="chart-container">
                        <h4>Income vs Expense Trend</h4>
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>Expense by Category</h4>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Finance Tracker View (Combined Tracker & Budget) -->
        <section id="trackerView" class="view">
            <div class="tracker-header">
                <h2>üí∞ Finance Tracker</h2>
                <div class="tracker-actions">
                    <div class="action-group">
                        <button class="btn-primary" id="addIncomeBtn">+ Income</button>
                        <button class="btn-danger" id="addExpenseBtn">+ Expense</button>
                        <button class="btn-secondary" id="addRecurringBtn">üîÑ Recurring</button>
                        <button class="btn-success" id="addBudgetBtn">+ Set Budget</button>
                    </div>
                    <div class="action-group">
                        <button class="btn-info" id="openSMSParserBtn" onclick="openSMSParser()">üì± SMS Parser</button>
                        <button class="btn-warning" id="processSMSBtn" onclick="processPendingSMSTransactions()">üîÑ Process SMS</button>
                    </div>
                    
                    <!-- Import and Export Buttons -->
                    <div class="import-export-buttons">
                        <!-- Export Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-export" id="trackerExportBtn">
                                üì§ Export
                            </button>
                            <div class="dropdown-menu" id="trackerExportMenu">
                                <div class="dropdown-section">
                                    <h5>üí∞ Transactions</h5>
                                    <button class="dropdown-item" onclick="exportTrackerData('income')">
                                        üíµ Export Income Only
                                    </button>
                                    <button class="dropdown-item" onclick="exportTrackerData('expenses')">
                                        üí∏ Export Expenses Only
                                    </button>
                                    <button class="dropdown-item" onclick="exportTrackerData('recurring')">
                                        üîÑ Export Recurring Transactions
                                    </button>
                                    <button class="dropdown-item" onclick="exportTrackerData('monthly')">
                                        üìä Export Monthly Summary
                                    </button>
                                    <button class="dropdown-item" onclick="exportTrackerData('complete')">
                                        üì¶ Export Complete Tracker
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üìä Budget</h5>
                                    <button class="dropdown-item" onclick="exportData('budget', 'json')">
                                        üìÑ Export Budget as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('budget', 'excel')">
                                        üìä Export Budget as Excel
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üì¶ Complete Finance</h5>
                                    <button class="dropdown-item" onclick="exportData('finance', 'json')">
                                        üìÑ Export All as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('finance', 'excel')">
                                        üìä Export All as Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Import Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-import" id="trackerImportBtn">
                                üì• Import
                            </button>
                            <div class="dropdown-menu" id="trackerImportMenu">
                                <div class="dropdown-section">
                                    <h5>üí∞ Transactions</h5>
                                    <button class="dropdown-item" onclick="document.getElementById('trackerImportIncome').click()">
                                        üíµ Import Income
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('trackerImportExpenses').click()">
                                        üí∏ Import Expenses
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('trackerImportRecurring').click()">
                                        üîÑ Import Recurring
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('trackerImportComplete').click()">
                                        üì¶ Import Complete Tracker
                                    </button>
                                    <input type="file" id="trackerImportIncome" accept=".json,.xlsx,.xls" style="display: none;" onchange="importTrackerData('income', this)">
                                    <input type="file" id="trackerImportExpenses" accept=".json,.xlsx,.xls" style="display: none;" onchange="importTrackerData('expenses', this)">
                                    <input type="file" id="trackerImportRecurring" accept=".json,.xlsx,.xls" style="display: none;" onchange="importTrackerData('recurring', this)">
                                    <input type="file" id="trackerImportComplete" accept=".json,.xlsx,.xls" style="display: none;" onchange="importTrackerData('complete', this)">
                                </div>
                                <div class="dropdown-section">
                                    <h5>üìä Budget</h5>
                                    <button class="dropdown-item" onclick="document.getElementById('budgetImportFile').click()">
                                        üìÑ Import Budget from JSON
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('budgetImportExcel').click()">
                                        üìä Import Budget from Excel
                                    </button>
                                    <input type="file" id="budgetImportFile" accept=".json" style="display: none;" onchange="importData('budget', 'json', this)">
                                    <input type="file" id="budgetImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importData('budget', 'excel', this)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Finance Summary Dashboard -->
            <div class="finance-summary">
                <div class="summary-row">
                    <div class="summary-card-finance transactions-summary">
                        <h4>üí∞ Transactions</h4>
                        <div class="metric">
                            <span class="label">Monthly Income</span>
                            <span class="value income" id="monthlyIncome">Rs. 0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Monthly Expenses</span>
                            <span class="value expense" id="monthlyExpense">Rs. 0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card-finance budget-summary">
                        <h4>üìä Budget</h4>
                        <div class="metric">
                            <span class="label">Budget Total</span>
                            <span class="value" id="budgetTotal">Rs. 0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Budget Used</span>
                            <span class="value" id="budgetPercentage">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module Tabs -->
            <div class="module-tabs">
                <button class="module-tab active" data-module="transactions">üí∞ Transactions</button>
                <button class="module-tab" data-module="budget">üìä Budget</button>
                <button class="module-tab" data-module="smsParser">üì± SMS Parser</button>
            </div>

            <!-- Transactions Module -->
            <div id="transactionsModule" class="finance-module active">
                <div class="filter-section">
                    <select id="trackerFilter">
                        <option value="all">All Transactions</option>
                        <option value="income">Income Only</option>
                        <option value="expense">Expense Only</option>
                        <option value="recurring">Recurring Only</option>
                    </select>
                    <input type="month" id="trackerMonth" class="month-filter">
                    <select id="currencyFilter">
                        <option value="NPR">NPR (‡§∞‡•Ç)</option>
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (‚Ç¨)</option>
                        <option value="INR">INR (‚Çπ)</option>
                    </select>
                </div>

                <div class="recurring-section" id="recurringSection">
                    <h3>üîÑ Recurring Transactions</h3>
                    <div id="recurringList"></div>
                </div>

                <div class="tracker-list" id="trackerList"></div>
            </div>

            <!-- Budget Module -->
            <div id="budgetModule" class="finance-module">
                <div class="budget-overview">
                    <div class="budget-summary-card">
                        <h3>Current Month Budget</h3>
                        <div class="budget-progress">
                            <div class="progress-info">
                                <span>Spent: <strong id="budgetSpent">Rs. 0</strong></span>
                                <span>Budget: <strong id="budgetTotal">Rs. 0</strong></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="budgetProgress"></div>
                            </div>
                            <div class="progress-percentage" id="budgetPercentage">0%</div>
                        </div>
                    </div>
                </div>

                <div class="budget-categories" id="budgetCategories"></div>

                <div class="budget-chart-container">
                    <h3>Budget vs Actual</h3>
                    <canvas id="budgetChart"></canvas>
                </div>

            <!-- SMS Parser Module -->
            <div id="smsParserModule" class="finance-module">
                <div class="sms-parser-header">
                    <h3>üì± Advanced SMS Transaction Parser</h3>
                    <p>Parse bank SMS messages with AI-powered learning and automatically add them as income/expense transactions</p>
                </div>

                <!-- SMS Parser Tabs -->
                <div class="sms-tabs-container">
                    <button class="sms-tab-btn active" onclick="switchSMSTab(this, 'tab-sms-parse')">
                        <i class="fas fa-paste"></i> Parse SMS
                    </button>
                    <button class="sms-tab-btn" onclick="switchSMSTab(this, 'tab-sms-bulk')">
                        <i class="fas fa-layer-group"></i> Bulk Process
                    </button>
                    <button class="sms-tab-btn" onclick="switchSMSTab(this, 'tab-sms-test')">
                        <i class="fas fa-flask"></i> Test Examples
                    </button>
                    <button class="sms-tab-btn" onclick="switchSMSTab(this, 'tab-sms-train')">
                        <i class="fas fa-brain"></i> Train Parser
                    </button>
                    <button class="sms-tab-btn" onclick="switchSMSTab(this, 'tab-sms-manage')">
                        <i class="fas fa-cog"></i> Manage
                    </button>
                </div>

                <!-- Parse SMS Tab -->
                <div id="tab-sms-parse" class="sms-tab-content active">
                    <div class="sms-input-section">
                        <div class="form-group">
                            <label for="smsInput">Paste Bank SMS Message:</label>
                            <textarea id="smsInput" class="form-control" rows="4" placeholder="Paste your bank SMS message here..." oninput="previewSMS()"></textarea>
                        </div>
                        
                        <div class="sms-parse-preview" id="smsParsePreview" style="display: none;">
                            <h4>üìä Parsed Transaction Details:</h4>
                            <div class="parsed-details" id="parsedDetails"></div>
                        </div>

                        <div class="sms-actions">
                            <button class="btn btn-primary" onclick="parseAndPreviewSMS()">
                                <i class="fas fa-search"></i> Parse SMS
                            </button>
                            <button class="btn btn-success" id="addParsedTransactionBtn" onclick="addParsedTransaction()" style="display: none;">
                                <i class="fas fa-plus"></i> Add as Transaction
                            </button>
                            <button class="btn btn-secondary" onclick="clearSMSInput()">
                                <i class="fas fa-eraser"></i> Clear
                            </button>
                            <button class="btn btn-info" onclick="readClipboardSMS()">
                                <i class="fas fa-clipboard"></i> Read from Clipboard
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bulk Process Tab -->
                <div id="tab-sms-bulk" class="sms-tab-content">
                    <div class="bulk-sms-section">
                        <div class="form-group">
                            <label for="bulkSmsInput">Multiple SMS Messages (one per line):</label>
                            <textarea id="bulkSmsInput" class="form-control" rows="8" placeholder="Paste multiple SMS messages, each on a new line..."></textarea>
                        </div>
                        
                        <div class="bulk-sms-actions">
                            <button class="btn btn-warning" onclick="processBulkSMS()">
                                <i class="fas fa-bolt"></i> Process All SMS
                            </button>
                            <button class="btn btn-secondary" onclick="clearBulkSMS()">
                                <i class="fas fa-eraser"></i> Clear
                            </button>
                        </div>
                        
                        <div class="bulk-progress" id="bulkProgress" style="display: none;">
                            <h4>üìä Processing Progress:</h4>
                            <div class="progress-info" id="bulkProgressInfo"></div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="bulkProgressFill"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Examples Tab -->
                <div id="tab-sms-test" class="sms-tab-content">
                    <div class="sms-test-section">
                        <div class="form-group">
                            <label for="testExample">Select Test Example:</label>
                            <select id="testExample" class="form-control" onchange="loadTestExample()">
                                <option value="">Select an example...</option>
                                <option value="nabil-credit">Nabil Bank - Credit</option>
                                <option value="nic-debit">NIC Asia - Debit</option>
                                <option value="esewa-payment">eSewa - Payment</option>
                                <option value="khalti-transfer">Khalti - Transfer</option>
                                <option value="global-deposit">Global IME - Deposit</option>
                                <option value="sanima-withdraw">Sanima - Withdrawal</option>
                                <option value="himalayan-transfer">Himalayan - Transfer</option>
                                <option value="nmb-purchase">NMB - Purchase</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="testSmsInput">Test SMS Message:</label>
                            <textarea id="testSmsInput" class="form-control" rows="4" placeholder="Or paste your own SMS to test..." oninput="testParseSMS()"></textarea>
                        </div>
                        
                        <div class="sms-test-preview" id="smsTestPreview" style="display: none;">
                            <h4>üß™ Test Result:</h4>
                            <div class="test-details" id="testDetails"></div>
                        </div>

                        <div class="sms-test-actions">
                            <button class="btn btn-primary" onclick="testParseSMS()">
                                <i class="fas fa-search"></i> Test Parse
                            </button>
                            <button class="btn btn-success" id="addTestTransactionBtn" onclick="addTestTransaction()" style="display: none;">
                                <i class="fas fa-plus"></i> Add Test Transaction
                            </button>
                            <button class="btn btn-secondary" onclick="clearTestSMS()">
                                <i class="fas fa-eraser"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Train Parser Tab -->
                <div id="tab-sms-train" class="sms-tab-content">
                    <div class="sms-train-section">
                        <div class="form-group">
                            <label for="trainSmsInput">SMS Message for Training:</label>
                            <textarea id="trainSmsInput" class="form-control" rows="4" placeholder="Paste SMS message to train the parser..."></textarea>
                        </div>
                        
                        <div class="training-controls">
                            <h4>üß† Select what to train:</h4>
                            <div class="training-fields">
                                <button class="training-field-btn" onclick="selectTrainingField('amount', this)" data-field="amount">
                                    üí∞ Amount
                                </button>
                                <button class="training-field-btn" onclick="selectTrainingField('credit', this)" data-field="credit">
                                    ‚¨áÔ∏è Credit
                                </button>
                                <button class="training-field-btn" onclick="selectTrainingField('debit', this)" data-field="debit">
                                    ‚¨ÜÔ∏è Debit
                                </button>
                                <button class="training-field-btn" onclick="selectTrainingField('bank', this)" data-field="bank">
                                    üè¶ Bank
                                </button>
                                <button class="training-field-btn" onclick="selectTrainingField('date', this)" data-field="date">
                                    üìÖ Date
                                </button>
                                <button class="training-field-btn" onclick="selectTrainingField('remarks', this)" data-field="remarks">
                                    üìù Remarks
                                </button>
                                <button class="training-field-btn" onclick="selectTrainingField('account', this)" data-field="account">
                                    üè¶ Account
                                </button>
                            </div>
                        </div>
                        
                        <div class="training-preview" id="trainingPreview" style="display: none;">
                            <h4>üìù Training Preview:</h4>
                            <div class="training-words" id="trainingWords"></div>
                        </div>
                        
                        <div class="training-actions">
                            <div class="form-group">
                                <label for="patternName">Pattern Name:</label>
                                <input type="text" id="patternName" class="form-control" placeholder="e.g., Nabil Credit Pattern">
                            </div>
                            <button class="btn btn-success" onclick="saveTrainingPattern()">
                                <i class="fas fa-save"></i> Save Pattern
                            </button>
                            <button class="btn btn-secondary" onclick="clearTraining()">
                                <i class="fas fa-eraser"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Manage Tab -->
                <div id="tab-sms-manage" class="sms-tab-content">
                    <div class="sms-manage-section">
                        <div class="manage-stats">
                            <h4>üìä SMS Parser Statistics</h4>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <span class="stat-label">Total Transactions</span>
                                    <span class="stat-value" id="totalSmsTransactions">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Saved Patterns</span>
                                    <span class="stat-value" id="totalPatterns">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Parse Accuracy</span>
                                    <span class="stat-value" id="parseAccuracy">0%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="manage-actions">
                            <button class="btn btn-warning" onclick="exportSMSData()">
                                <i class="fas fa-download"></i> Export SMS Data
                            </button>
                            <button class="btn btn-info" onclick="importSMSData()">
                                <i class="fas fa-upload"></i> Import SMS Data
                            </button>
                            <button class="btn btn-danger" onclick="clearAllSMSData()">
                                <i class="fas fa-trash"></i> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>

                <div class="sms-instructions">
                    <h4>üìñ Instructions:</h4>
                    <ul>
                        <li>Paste any bank SMS message containing transaction details</li>
                        <li>The parser will automatically extract amount, type, bank, date, and description</li>
                        <li>Review parsed details and click "Add as Transaction" to save</li>
                        <li>Use the Train tab to improve parsing accuracy for your bank's SMS format</li>
                        <li>Supported banks: Nabil, Global IME, Sanima, NIC Asia, Himalayan, eSewa, Khalti, and more</li>
                    </ul>
                </div>

                <div class="recent-sms-transactions" id="recentSmsTransactions">
                    <h4>üìã Recent SMS Transactions</h4>
                    <div id="recentSmsList"></div>
                </div>
            </div>
        </section>

        <!-- Financial Manager View (Combined Bills, Goals & Subscriptions) -->
        <section id="financialView" class="view">
            <div class="financial-header">
                <h2>üí≥ Financial Manager</h2>
                <div class="financial-actions">
                    <div class="action-group">
                        <button class="btn-primary" id="addBillBtn">+ Add Bill</button>
                        <button class="btn-success" id="addGoalBtn">+ New Goal</button>
                        <button class="btn-info" id="addSubscriptionBtn">+ Add Subscription</button>
                        <button class="btn-warning" id="addShoppingBtn">+ Add Shopping Item</button>
                        <button class="btn-secondary" id="addCustomTypeBtn">+ New Custom Type</button>
                    </div>
                    
                    <!-- Import and Export Buttons -->
                    <div class="import-export-buttons">
                        <!-- Export Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-export" id="financialExportBtn">
                                üì§ Export
                            </button>
                            <div class="dropdown-menu" id="financialExportMenu">
                                <div class="dropdown-section">
                                    <h5>üí≥ Bills</h5>
                                    <button class="dropdown-item" onclick="exportData('bills', 'json')">
                                        üìÑ Export Bills as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('bills', 'excel')">
                                        üìä Export Bills as Excel
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üéØ Goals</h5>
                                    <button class="dropdown-item" onclick="exportData('goals', 'json')">
                                        üìÑ Export Goals as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('goals', 'excel')">
                                        üìä Export Goals as Excel
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üì∫ Subscriptions</h5>
                                    <button class="dropdown-item" onclick="exportData('subscription', 'json')">
                                        üìÑ Export Subscriptions as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('subscription', 'excel')">
                                        üìä Export Subscriptions as Excel
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üõí Shopping</h5>
                                    <button class="dropdown-item" onclick="exportData('shopping', 'json')">
                                        üìÑ Export Shopping as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('shopping', 'excel')">
                                        üìä Export Shopping as Excel
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üìã Custom Data</h5>
                                    <button class="dropdown-item" onclick="exportData('custom', 'json')">
                                        üìÑ Export Custom as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('custom', 'excel')">
                                        üìä Export Custom as Excel
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üì¶ Complete Financial</h5>
                                    <button class="dropdown-item" onclick="exportData('financial', 'json')">
                                        üìÑ Export All as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('financial', 'excel')">
                                        üìä Export All as Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Import Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-import" id="financialImportBtn">
                                üì• Import
                            </button>
                            <div class="dropdown-menu" id="financialImportMenu">
                                <div class="dropdown-section">
                                    <h5>üí≥ Bills</h5>
                                    <button class="dropdown-item" onclick="document.getElementById('billsImportFile').click()">
                                        üìÑ Import Bills from JSON
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('billsImportExcel').click()">
                                        üìä Import Bills from Excel
                                    </button>
                                    <input type="file" id="billsImportFile" accept=".json" style="display: none;" onchange="importData('bills', 'json', this)">
                                    <input type="file" id="billsImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importData('bills', 'excel', this)">
                                </div>
                                <div class="dropdown-section">
                                    <h5>üéØ Goals</h5>
                                    <button class="dropdown-item" onclick="document.getElementById('goalsImportFile').click()">
                                        üìÑ Import Goals from JSON
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('goalsImportExcel').click()">
                                        üìä Import Goals from Excel
                                    </button>
                                    <input type="file" id="goalsImportFile" accept=".json" style="display: none;" onchange="importData('goals', 'json', this)">
                                    <input type="file" id="goalsImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importData('goals', 'excel', this)">
                                </div>
                                <div class="dropdown-section">
                                    <h5>üõí Shopping</h5>
                                    <button class="dropdown-item" onclick="document.getElementById('shoppingImportFile').click()">
                                        üìÑ Import Shopping from JSON
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('shoppingImportExcel').click()">
                                        üìä Import Shopping from Excel
                                    </button>
                                    <input type="file" id="shoppingImportFile" accept=".json" style="display: none;" onchange="importData('shopping', 'json', this)">
                                    <input type="file" id="shoppingImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importData('shopping', 'excel', this)">
                                </div>
                                <div class="dropdown-section">
                                    <h5>üìã Custom Data</h5>
                                    <button class="dropdown-item" onclick="document.getElementById('customImportFile').click()">
                                        üìÑ Import Custom from JSON
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('customImportExcel').click()">
                                        üìä Import Custom from Excel
                                    </button>
                                    <input type="file" id="customImportFile" accept=".json" style="display: none;" onchange="importData('custom', 'json', this)">
                                    <input type="file" id="customImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importData('custom', 'excel', this)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Summary Dashboard -->
            <div class="financial-summary">
                <div class="summary-row">
                    <div class="summary-card-financial bills-summary">
                        <h4>üí≥ Bills</h4>
                        <div class="metric">
                            <span class="label">Pending</span>
                            <span class="value" id="pendingBillsCount">0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Overdue</span>
                            <span class="value overdue" id="overdueBillsCount">0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card-financial goals-summary">
                        <h4>üéØ Goals</h4>
                        <div class="metric">
                            <span class="label">Active Goals</span>
                            <span class="value" id="activeGoalsCount">0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Total Saved</span>
                            <span class="value" id="totalGoalsSaved">Rs. 0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card-financial subscriptions-summary">
                        <h4>üì∫ Subscriptions</h4>
                        <div class="metric">
                            <span class="label">Monthly Cost</span>
                            <span class="value" id="monthlySubCost">Rs. 0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Annual Cost</span>
                            <span class="value" id="annualSubCost">Rs. 0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card-financial shopping-summary">
                        <h4>üõí Shopping</h4>
                        <div class="metric">
                            <span class="label">Pending Items</span>
                            <span class="value" id="pendingShoppingCount">0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Total Budget</span>
                            <span class="value" id="shoppingBudget">Rs. 0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card-financial custom-summary">
                        <h4>üìã Custom Data</h4>
                        <div class="metric">
                            <span class="label">Custom Types</span>
                            <span class="value" id="customTypesCount">0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Total Items</span>
                            <span class="value" id="customItemsCount">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module Tabs -->
            <div class="module-tabs">
                <button class="module-tab active" data-module="bills">üí≥ Bills</button>
                <button class="module-tab" data-module="goals">üéØ Goals</button>
                <button class="module-tab" data-module="subscriptions">üì∫ Subscriptions</button>
                <button class="module-tab" data-module="shopping">üõí Shopping</button>
                <button class="module-tab" data-module="custom">üìã Custom</button>
            </div>

            <!-- Bills Module -->
            <div id="billsModule" class="financial-module active">
                <div class="upcoming-bills">
                    <h3>‚è∞ Upcoming Bills</h3>
                    <div id="upcomingBillsList"></div>
                </div>

                <div class="filter-section">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="pending">Pending</button>
                    <button class="filter-btn" data-filter="paid">Paid</button>
                    <button class="filter-btn" data-filter="overdue">Overdue</button>
                </div>

                <div class="bills-list" id="billsList"></div>
            </div>

            <!-- Goals Module -->
            <div id="goalsModule" class="financial-module">
                <div class="goals-grid" id="goalsGrid"></div>
            </div>

            <!-- Subscriptions Module -->
            <div id="subscriptionsModule" class="financial-module">
                <div class="filter-section">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="active">Active</button>
                    <button class="filter-btn" data-filter="paused">Paused</button>
                    <button class="filter-btn" data-filter="cancelled">Cancelled</button>
                </div>

                <div class="subscription-list" id="subscriptionList"></div>
            </div>

            <!-- Shopping Module -->
            <div id="shoppingModule" class="financial-module">
                <div class="filter-section">
                    <button class="filter-btn active" data-filter="pending">Pending</button>
                    <button class="filter-btn" data-filter="purchased">Purchased</button>
                    <button class="filter-btn" data-filter="all">All</button>
                </div>

                <div class="shopping-list" id="shoppingList"></div>
            </div>

            <!-- Custom Module -->
            <div id="customModule" class="financial-module">
                <div class="custom-types" id="customTypes"></div>
                <div class="custom-items" id="customItems"></div>
            </div>
        </section>

        <!-- Asset Manager View (Combined Insurance & Vehicle) -->
        <section id="assetsView" class="view">
            <div class="assets-header">
                <h2>üõ°Ô∏è Asset Manager</h2>
                <div class="assets-actions">
                    <div class="action-group">
                        <button class="btn-primary" id="addInsuranceBtn">+ Add Policy</button>
                        <button class="btn-success" id="addVehicleBtn">+ Add Vehicle</button>
                    </div>
                    
                    <!-- Import and Export Buttons -->
                    <div class="import-export-buttons">
                        <!-- Export Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-export" id="assetsExportBtn">
                                üì§ Export
                            </button>
                            <div class="dropdown-menu" id="assetsExportMenu">
                                <div class="dropdown-section">
                                    <h5>üõ°Ô∏è Insurance</h5>
                                    <button class="dropdown-item" onclick="exportData('insurance', 'json')">
                                        üìÑ Export Insurance as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('insurance', 'excel')">
                                        üìä Export Insurance as Excel
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üöó Vehicles</h5>
                                    <button class="dropdown-item" onclick="exportData('vehicle', 'json')">
                                        üìÑ Export Vehicles as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('vehicle', 'excel')">
                                        üìä Export Vehicles as Excel
                                    </button>
                                </div>
                                <div class="dropdown-section">
                                    <h5>üì¶ Complete Assets</h5>
                                    <button class="dropdown-item" onclick="exportData('assets', 'json')">
                                        üìÑ Export All as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportData('assets', 'excel')">
                                        üìä Export All as Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Import Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-import" id="assetsImportBtn">
                                üì• Import
                            </button>
                            <div class="dropdown-menu" id="assetsImportMenu">
                                <div class="dropdown-section">
                                    <h5>üõ°Ô∏è Insurance</h5>
                                    <button class="dropdown-item" onclick="document.getElementById('insuranceImportFile').click()">
                                        üìÑ Import Insurance from JSON
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('insuranceImportExcel').click()">
                                        üìä Import Insurance from Excel
                                    </button>
                                    <input type="file" id="insuranceImportFile" accept=".json" style="display: none;" onchange="importData('insurance', 'json', this)">
                                    <input type="file" id="insuranceImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importData('insurance', 'excel', this)">
                                </div>
                                <div class="dropdown-section">
                                    <h5>üöó Vehicles</h5>
                                    <button class="dropdown-item" onclick="document.getElementById('vehicleImportFile').click()">
                                        üìÑ Import Vehicles from JSON
                                    </button>
                                    <button class="dropdown-item" onclick="document.getElementById('vehicleImportExcel').click()">
                                        üìä Import Vehicles from Excel
                                    </button>
                                    <input type="file" id="vehicleImportFile" accept=".json" style="display: none;" onchange="importData('vehicle', 'json', this)">
                                    <input type="file" id="vehicleImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importData('vehicle', 'excel', this)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Asset Summary Dashboard -->
            <div class="assets-summary">
                <div class="summary-row">
                    <div class="summary-card-assets insurance-summary">
                        <h4>üõ°Ô∏è Insurance</h4>
                        <div class="metric">
                            <span class="label">Total Policies</span>
                            <span class="value" id="totalPolicies">0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Annual Premium</span>
                            <span class="value" id="totalPremium">Rs. 0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card-assets vehicle-summary">
                        <h4>üöó Vehicles</h4>
                        <div class="metric">
                            <span class="label">Total Vehicles</span>
                            <span class="value" id="totalVehicles">0</span>
                        </div>
                        <div class="metric">
                            <span class="label">Active Vehicles</span>
                            <span class="value" id="activeVehicles">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module Tabs -->
            <div class="module-tabs">
                <button class="module-tab active" data-module="insurance">üõ°Ô∏è Insurance</button>
                <button class="module-tab" data-module="vehicles">üöó Vehicles</button>
            </div>

            <!-- Insurance Module -->
            <div id="insuranceModule" class="asset-module active">
                <div class="insurance-stats">
                    <div class="stat-card">
                        <span class="stat-label">Total Policies</span>
                        <span class="stat-value" id="totalPolicies">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Active Policies</span>
                        <span class="stat-value" id="activePolicies">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Annual Premium</span>
                        <span class="stat-value" id="totalPremium">Rs. 0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Expiring Soon</span>
                        <span class="stat-value" id="expiringSoon">0</span>
                    </div>
                </div>

                <div class="filter-section">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="life">Life</button>
                    <button class="filter-btn" data-filter="health">Health</button>
                    <button class="filter-btn" data-filter="vehicle">Vehicle</button>
                    <button class="filter-btn" data-filter="property">Property</button>
                </div>

                <div class="insurance-list" id="insuranceList"></div>
            </div>

            <!-- Vehicles Module -->
            <div id="vehiclesModule" class="asset-module">
                <div class="vehicle-grid" id="vehicleGrid"></div>
            </div>
        </section>



        <!-- Notes View -->
        <section id="notesView" class="view">
            <div class="notes-header">
                <h2>üìù Notes & Reminders</h2>
                <div class="notes-actions">
                    <button class="btn-primary" id="addNoteBtn">+ Add Note</button>
                    
                    <!-- Import and Export Buttons -->
                    <div class="import-export-buttons">
                        <!-- Export Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-export" id="notesExportBtn">
                                üì§ Export
                            </button>
                            <div class="dropdown-menu" id="notesExportMenu">
                                <button class="dropdown-item" onclick="exportData('notes', 'json')">
                                    üìÑ Export as JSON
                                </button>
                                <button class="dropdown-item" onclick="exportData('notes', 'excel')">
                                    üìä Export as Excel
                                </button>
                            </div>
                        </div>
                        
                        <!-- Import Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-import" id="notesImportBtn">
                                üì• Import
                            </button>
                            <div class="dropdown-menu" id="notesImportMenu">
                                <button class="dropdown-item" onclick="document.getElementById('notesImportFile').click()">
                                    üìÑ Import from JSON
                                </button>
                                <button class="dropdown-item" onclick="document.getElementById('notesImportExcel').click()">
                                    üìä Import from Excel
                                </button>
                                <input type="file" id="notesImportFile" accept=".json" style="display: none;" onchange="importData('notes', 'json', this)">
                                <input type="file" id="notesImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importData('notes', 'excel', this)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="upcoming-reminders" id="upcomingReminders">
                <h3>üîî Upcoming Reminders</h3>
                <div id="remindersList"></div>
            </div>

            <div class="notes-list" id="notesList"></div>
        </section>

        <!-- Medicine Tracker View -->
        <section id="medicineView" class="view">
            <div class="medicine-header">
                <h2>üíä Medicine Tracker</h2>
                <div class="medicine-actions">
                    <div class="action-group">
                        <button class="btn-primary" id="addMedicineBtn">+ Add Medicine</button>
                        <button class="btn-info" id="addFamilyMemberBtn">+ Add Family Member</button>
                    </div>
                    
                    <!-- Import and Export Buttons -->
                    <div class="import-export-buttons">
                        <!-- Export Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-export" id="medicineExportBtn">
                                üì§ Export
                            </button>
                            <div class="dropdown-menu" id="medicineExportMenu">
                                <div class="dropdown-section">
                                    <h5>üíä Medicine Data</h5>
                                    <button class="dropdown-item" onclick="exportMedicineData('medicines')">
                                        üìÑ Export Medicines as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportMedicineData('medicines', 'excel')">
                                        üìä Export Medicines as Excel
                                    </button>
                                    <button class="dropdown-item" onclick="exportMedicineData('family')">
                                        üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Export Family Members as JSON
                                    </button>
                                    <button class="dropdown-item" onclick="exportMedicineData('complete')">
                                        üì¶ Export Complete Medicine Data
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Import Dropdown -->
                        <div class="dropdown-container">
                            <button class="btn-import" id="medicineImportBtn">
                                üì• Import
                            </button>
                            <div class="dropdown-menu" id="medicineImportMenu">
                                <button class="dropdown-item" onclick="document.getElementById('medicineImportFile').click()">
                                    üìÑ Import Medicines from JSON
                                </button>
                                <button class="dropdown-item" onclick="document.getElementById('medicineImportExcel').click()">
                                    üìä Import Medicines from Excel
                                </button>
                                <input type="file" id="medicineImportFile" accept=".json" style="display: none;" onchange="importMedicineData('json', this)">
                                <input type="file" id="medicineImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importMedicineData('excel', this)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module Tabs -->
            <div class="module-tabs">
                <button class="module-tab active" data-module="medicines">üíä Medicines</button>
                <button class="module-tab" data-module="family">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Members</button>
                <button class="module-tab" data-module="schedule">‚è∞ Schedule</button>
                <button class="module-tab" data-module="prescriptions">üìã Prescriptions</button>
            </div>

            <!-- Medicines Module -->
            <div id="medicinesModule" class="medicine-module active">
                <div class="medicine-filters">
                    <select id="medicineFilter">
                        <option value="all">All Medicines</option>
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                        <option value="expired">Expired</option>
                    </select>
                    <select id="memberFilter">
                        <option value="all">All Family Members</option>
                    </select>
                    <input type="text" id="medicineSearch" placeholder="Search medicines...">
                </div>

                <div class="medicine-stats">
                    <div class="stat-card">
                        <h4>Active Medicines</h4>
                        <span id="activeMedicinesCount">0</span>
                    </div>
                    <div class="stat-card">
                        <h4>Today's Doses</h4>
                        <span id="todayDosesCount">0</span>
                    </div>
                    <div class="stat-card">
                        <h4>Expiring Soon</h4>
                        <span id="expiringCount">0</span>
                    </div>
                </div>

                <div class="medicine-list" id="medicineList"></div>
            </div>

            <!-- Family Members Module -->
            <div id="familyModule" class="medicine-module">
                <div class="family-members-list" id="familyMembersList"></div>
            </div>

            <!-- Schedule Module -->
            <div id="scheduleModule" class="medicine-module">
                <div class="schedule-view">
                    <div class="schedule-header">
                        <h3>Today's Medicine Schedule</h3>
                        <div class="schedule-date" id="scheduleDate"></div>
                    </div>
                    <div class="schedule-list" id="scheduleList"></div>
                </div>
            </div>

            <!-- Prescriptions Module -->
            <div id="prescriptionsModule" class="medicine-module">
                <div class="prescriptions-list" id="prescriptionsList"></div>
            </div>
        </section>

        <!-- Settings View -->
        <section id="settingsView" class="view">
            <div class="settings-container">
                <h2>‚öôÔ∏è Settings</h2>

                <!-- Theme Toggle -->
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="darkModeToggle">
                        <span>üåô Dark Mode</span>
                    </label>
                </div>

                <!-- Holiday Management -->
                <div class="setting-section">
                    <h3>üéâ Holiday Management</h3>
                    <div class="holiday-controls">
                        <button class="btn-primary" id="addHolidayBtn">+ Add Holiday</button>
                        <button class="btn-secondary" id="importHolidayBtn">üì• Import CSV</button>
                        <button class="btn-warning" id="removeDuplicateHolidaysBtn">üóëÔ∏è Remove Duplicates</button>
                        <input type="file" id="holidayFileInput" accept=".csv" hidden>
                    </div>
                    <div class="holiday-list" id="holidayList"></div>
                </div>

                <!-- Data Management -->
                <div class="setting-section">
                    <h3>üíæ Data Management</h3>
                    
                    <!-- Global Duplicate Detection -->
                    <div class="duplicate-management">
                        <h4>üîç Duplicate Detection</h4>
                        <div class="button-group">
                            <button class="btn-warning" id="globalDuplicateScanBtn">
                                üîç Scan All Modules for Duplicates
                            </button>
                        </div>
                        <div id="duplicateScanResults" class="duplicate-results" style="display: none;">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Overall Import/Export -->
                    <div class="import-export-group">
                        <h4>üåê Overall Data</h4>
                        <div class="button-group">
                            <div class="import-export-dropdown">
                                <button class="import-export-btn" id="overallExportBtn">
                                    üì§ Export All Data
                                </button>
                                <div class="dropdown-menu" id="overallExportMenu">
                                    <div class="dropdown-section">
                                        <h5>üì§ Export Format</h5>
                                        <button class="dropdown-item" onclick="exportAllData('json')">
                                            üìÑ Export Complete as JSON
                                        </button>
                                        <button class="dropdown-item" onclick="exportAllData('excel')">
                                            üìä Export Complete as Excel
                                        </button>
                                        <button class="dropdown-item" onclick="exportAllData('csv')">
                                            üìã Export Complete as CSV
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="import-export-dropdown">
                                <button class="import-export-btn" id="overallImportBtn">
                                    üì• Import Data
                                </button>
                                <div class="dropdown-menu" id="overallImportMenu">
                                    <div class="dropdown-section">
                                        <h5>üì• Import Format</h5>
                                        <button class="dropdown-item" onclick="document.getElementById('overallImportJson').click()">
                                            üìÑ Import from JSON
                                        </button>
                                        <button class="dropdown-item" onclick="document.getElementById('overallImportExcel').click()">
                                            üìä Import from Excel
                                        </button>
                                        <button class="dropdown-item" onclick="document.getElementById('overallImportCsv').click()">
                                            üìã Import from CSV
                                        </button>
                                        <input type="file" id="overallImportJson" accept=".json" style="display: none;" onchange="importAllData('json', this)">
                                        <input type="file" id="overallImportExcel" accept=".xlsx,.xls" style="display: none;" onchange="importAllData('excel', this)">
                                        <input type="file" id="overallImportCsv" accept=".csv" style="display: none;" onchange="importAllData('csv', this)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Module-specific Import/Export -->
                    <div class="import-export-group">
                        <h4>üì¶ Module-specific Data</h4>
                        <div class="module-grid">
                            <div class="import-export-dropdown">
                                <button class="import-export-btn small" id="calendarDataBtn">
                                    üìÖ Calendar
                                </button>
                                <div class="dropdown-menu" id="calendarDataMenu">
                                    <button class="dropdown-item" onclick="exportModuleData('calendar', 'json')">üìÑ JSON</button>
                                    <button class="dropdown-item" onclick="exportModuleData('calendar', 'excel')">üìä Excel</button>
                                    <button class="dropdown-item" onclick="document.getElementById('calendarModuleImport').click()">üì• Import</button>
                                    <input type="file" id="calendarModuleImport" accept=".json,.xlsx,.xls" style="display: none;" onchange="importModuleData('calendar', this)">
                                </div>
                            </div>
                            
                            <div class="import-export-dropdown">
                                <button class="import-export-btn small" id="financeDataBtn">
                                    üí∞ Finance Tracker
                                </button>
                                <div class="dropdown-menu" id="financeDataMenu">
                                    <button class="dropdown-item" onclick="exportModuleData('finance', 'json')">üìÑ JSON</button>
                                    <button class="dropdown-item" onclick="exportModuleData('finance', 'excel')">üìä Excel</button>
                                    <button class="dropdown-item" onclick="document.getElementById('financeModuleImport').click()">üì• Import</button>
                                    <input type="file" id="financeModuleImport" accept=".json,.xlsx,.xls" style="display: none;" onchange="importModuleData('finance', this)">
                                </div>
                            </div>
                            
                            <div class="import-export-dropdown">
                                <button class="import-export-btn small" id="assetsDataBtn">
                                    üõ°Ô∏è Asset Manager
                                </button>
                                <div class="dropdown-menu" id="assetsDataMenu">
                                    <button class="dropdown-item" onclick="exportModuleData('assets', 'json')">üìÑ JSON</button>
                                    <button class="dropdown-item" onclick="exportModuleData('assets', 'excel')">üìä Excel</button>
                                    <button class="dropdown-item" onclick="document.getElementById('assetsModuleImport').click()">üì• Import</button>
                                    <input type="file" id="assetsModuleImport" accept=".json,.xlsx,.xls" style="display: none;" onchange="importModuleData('assets', this)">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Operations -->
                    <div class="data-operations">
                        <h4>‚öôÔ∏è Data Operations</h4>
                        <div class="button-group">
                            <button class="btn-secondary" id="backupDataBtn">‚òÅÔ∏è Backup to Cloud</button>
                            <button class="btn-secondary" id="restoreDataBtn">üîÑ Restore from Backup</button>
                            <button class="btn-danger" id="clearDataBtn">üóëÔ∏è Clear All Data</button>
                        </div>
                    </div>
                </div>

                <!-- App Info -->
                <div class="setting-section">
                    <h3>‚ÑπÔ∏è About</h3>
                    <p><strong>App:</strong> Nepali Calendar 2082‚Äì2092 Complete Manager</p>
                    <p><strong>Version:</strong> 2.0.0</p>
                    <p><strong>Modules:</strong> Calendar, Finance, Insurance, Vehicle, Subscriptions, Custom Data</p>
                    <p><strong>Developer:</strong> Santosh Phuyal</p>
                    <p><strong>Email:</strong> hisantoshphuyal@gmail.com</p>
                </div>
            </div>
        </section>

    </main>

    <!-- Floating Action Button -->
    <div class="fab" id="fab">
        <button class="fab-button">+</button>
        <div class="fab-menu" id="fabMenu">
            <button class="fab-item" data-action="income">üíµ Income</button>
            <button class="fab-item" data-action="expense">üí∏ Expense</button>
            <button class="fab-item" data-action="note">üìù Note</button>
            <button class="fab-item" data-action="shopping">üõí Shopping</button>
            <button class="fab-item" data-action="insurance">üõ°Ô∏è Insurance</button>
            <button class="fab-item" data-action="vehicle">üöó Vehicle</button>
        </div>
    </div>

    <!-- Modal Container -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle"></h3>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Date Detail Drawer -->
    <div class="drawer" id="dateDrawer">
        <div class="drawer-content">
            <div class="drawer-header">
                <h3 id="drawerTitle">Date Details</h3>
                <button class="drawer-close">&times;</button>
            </div>
            <div class="drawer-body" id="drawerBody"></div>
        </div>
    </div>

        <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="conversion.js"></script>
    <script src="db.js"></script>
    <script src="charts.js"></script>
    <script src="budget.js"></script>
    <script src="insurance.js"></script>
    <script src="vehicle.js"></script>
    <script src="subscription.js"></script>
    <script src="custom.js"></script>
    <script src="import-export.js"></script>
    <script src="medicine-tracker.js"></script>
    <script src="nepali-date-picker.js"></script>
    <script src="app.js"></script>
    
    <!-- Service Worker Registration - FIXED -->
    <script>
        // Suppress WebSocket connection errors from development tools
        const originalConsoleError = console.error;
        const originalConsoleLog = console.log;
        
        console.error = function(...args) {
            const message = args.join(' ');
            // Suppress WebSocket connection errors and related development tool errors
            if (message.includes('WebSocket connection to') && 
                (message.includes('failed') || message.includes('closed'))) {
                return; // Suppress WebSocket connection errors
            }
            return originalConsoleError.apply(console, args);
        };
        
        console.log = function(...args) {
            const message = args.join(' ');
            // Suppress WebSocket connection errors that appear in console.log
            if (message.includes('WebSocket connection to') && 
                (message.includes('failed') || message.includes('closed'))) {
                return; // Suppress WebSocket connection errors
            }
            return originalConsoleLog.apply(console, args);
        };
        
        // Only register service worker if running on http/https (not file://)
        if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => {
                        console.log('‚úÖ Service Worker Registered', reg.scope);
                    })
                    .catch(err => {
                        console.log('‚ùå Service Worker Registration Failed', err);
                    });
            });
        } else if (window.location.protocol === 'file:') {
            console.log('‚ö†Ô∏è Service Worker not registered (file:// protocol)');
            console.log('üìå Run on local server for full PWA features:');
            console.log('   python -m http.server 8000');
            console.log('   Then open: http://localhost:8000');
        }
    </script>
    
    <!-- Load Verification -->
    <script>
        console.log('=== SCRIPT LOAD CHECK ===');
        console.log('Chart.js loaded:', typeof Chart !== 'undefined');
        console.log('conversion.js loaded:', typeof getCurrentNepaliDate !== 'undefined');
        console.log('db.js loaded:', typeof initDB !== 'undefined');
        console.log('charts.js loaded:', typeof renderTrendChart !== 'undefined');
        console.log('budget.js loaded:', typeof updateBudgetOverview !== 'undefined');
        console.log('insurance.js loaded:', typeof showInsuranceForm !== 'undefined');
        console.log('vehicle.js loaded:', typeof showVehicleForm !== 'undefined');
        console.log('subscription.js loaded:', typeof showSubscriptionForm !== 'undefined');
        console.log('custom.js loaded:', typeof showCustomTypeForm !== 'undefined');
        console.log('app.js loaded:', typeof renderCalendar !== 'undefined');
        console.log('=== END LOAD CHECK ===');
    </script>

    <!-- Developer Footer -->
    <footer class="developer-footer">
        <div class="developer-info">
            <div class="app-details">
                <span class="app-name">Nepali Calendar 2082‚Äì2092</span>
                <span class="version">v2.0.0</span>
            </div>
            <div class="developer-details">
                <span class="developer">Developed by: Santosh Phuyal</span>
                <span class="contact">üìß hisantoshphuyal@gmail.com</span>
            </div>
        </div>
    </footer>
</body>
</html>
